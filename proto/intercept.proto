syntax = "proto3";

package intercept;

service InterceptDiscovery {
  rpc Intercepts(stream DiscoveryRequest) returns (stream DiscoveryResponse) {}
}

message DiscoveryRequest {
  oneof payload {
    PdsHello hello = 1;
    Ack ack = 2;
  }
}

message DiscoveryResponse {
  oneof payload {
    AddIntercept add = 1;
    RemoveIntercept remove = 2;
    SnapshotSent snapshot_sent = 3;
  }
}

message PdsHello {
  string node_ip = 1;
  string revision = 2;
}

message Ack {
  string uid = 1;
  string error = 2;
}

message AddIntercept {
  string uid = 1;
  InterceptEndpoint endpoint = 2;
}

message RemoveIntercept {
  string uid = 1;
}

message SnapshotSent {
  string revision = 1;
}

message InterceptEndpoint {
  repeated PodIdentifier pod_ids = 1;
  string namespace = 2;
  int32 target_port = 3;
}

message PodIdentifier {
  string name = 1;
  string ip = 2;
  string host_ip = 3;
}

